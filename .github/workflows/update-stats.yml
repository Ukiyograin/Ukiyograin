name: Fix Stats Images

on:
  schedule:
    - cron: "0 */2 * * *" # æ¯2å°æ—¶ä¸€æ¬¡
  workflow_dispatch:

permissions:
  contents: write

jobs:
  fix-images:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Fix image URLs
        run: |
          TIMESTAMP=$(date +%s)
          
          # ç®€åŒ–ï¼šç›´æ¥æ›¿æ¢æ•´ä¸ªimgæ ‡ç­¾
          sed -i "s|<img src=\"https://github-readme-stats-inky-one-21.vercel.app/api?username=Ukiyograin[^\"]*\"|<img src=\"https://github-readme-stats-inky-one-21.vercel.app/api?username=Ukiyograin&show_icons=true&theme=transparent&v=$TIMESTAMP\"|g" README.md
          
          sed -i "s|<img src=\"https://github-readme-stats-inky-one-21.vercel.app/api/top-langs/[^\"]*\"|<img src=\"https://github-readme-stats-inky-one-21.vercel.app/api/top-langs/?username=Ukiyograin&layout=compact&hide_border=true&icon_color=586069&title_color=24292e&width=400&v=$TIMESTAMP\"|g" README.md
          
          echo "URLs updated with timestamp: $TIMESTAMP"

      - name: Commit changes
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add README.md
          git diff --quiet && git diff --staged --quiet || (git commit -m "ğŸ”„ Update stats images" && git push)
